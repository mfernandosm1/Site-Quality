<% layout('layout') -%>
<div class="card">
  <h3>ğŸ§¾ Sobre (Visual)</h3>
  <p class="muted mb-2">Edite o texto e Ã­cones visualmente. O botÃ£o abaixo salva diretamente no arquivo <code>sobre.html</code>.</p>

  <textarea id="editorSobre"><%- html %></textarea>
  <div style="margin-top:10px;display:flex;gap:8px;">
    <button id="saveSobre" class="btn primary">ğŸ’¾ Salvar (Visual)</button>
    <a href="/sobre" class="btn ghost">ğŸ”„ Recarregar do HTML</a>
  </div>
</div>

<div class="card mt-3">
  <h4>Modo CÃ³digo (HTML)</h4>
  <form method="post" action="/sobre/salvar">
    <textarea name="html" rows="15" class="w-full border p-2 font-mono"><%- html %></textarea>
    <button class="btn mt-2">Salvar (CÃ³digo)</button>
  </form>
</div>

<!-- CKEditor moderno -->
<script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
<script>
let editorSobre;
ClassicEditor.create(document.querySelector('#editorSobre'), {
  toolbar: [
    'heading','|','bold','italic','underline','link','bulletedList','numberedList','blockQuote',
    '|','insertTable','imageUpload','mediaEmbed','undo','redo','sourceEditing'
  ]
}).then(e=>{
  editorSobre = e;
  document.getElementById('saveSobre').addEventListener('click', async ()=>{
    const conteudo = editorSobre.getData();
    const resp = await fetch('/sobre/salvar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ html: conteudo })
    });
    alert(resp.ok ? 'âœ… PÃ¡gina "Sobre" salva!' : 'âŒ Erro ao salvar.');
  });
});
</script>
