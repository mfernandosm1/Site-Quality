<% layout('layout') -%>
<header><div class="brand container">Páginas → Formas de Pagamento (Campos)</div></header>
<div class="container">

  <!-- Banner de sucesso (começa escondido de verdade) -->
  <div id="flash-box" style="display:none;margin-bottom:12px;padding:10px 12px;border-radius:8px;
    background:#e8f7ee;border:1px solid #bfe8cc;color:#165f2a;align-items:center;gap:8px;font-weight:500;">
    ✅ Salvo com sucesso!
  </div>

  <div class="card">
    <form method="post" action="/paginas-formas/save">
      <label><small>Título (H1)</small><input type="text" name="titulo" value="<%= titulo %>"></label>
      <hr/>
      <div style="display:grid;gap:10px;grid-template-columns:repeat(3,1fr)">
        <div>
          <label><small>Cartão — Título</small><input type="text" name="cartaoTitulo" value="<%= cartaoTitulo %>"></label>
          <label><small>Cartão — Texto</small><textarea name="cartaoTexto" rows="3"><%= cartaoTexto %></textarea></label>
        </div>
        <div>
          <label><small>Boleto — Título</small><input type="text" name="boletoTitulo" value="<%= boletoTitulo %>"></label>
          <label><small>Boleto — Texto</small><textarea name="boletoTexto" rows="3"><%= boletoTexto %></textarea></label>
        </div>
        <div>
          <label><small>PIX — Título</small><input type="text" name="pixTitulo" value="<%= pixTitulo %>"></label>
          <label><small>PIX — Texto</small><textarea name="pixTexto" rows="3"><%= pixTexto %></textarea></label>
        </div>
      </div>
      <hr/>
      <label><small>Envios — Título</small><input type="text" name="enviosTitulo" value="<%= enviosTitulo %>"></label>
      <label><small>Envios — Linha 1</small><input type="text" name="enviosLinha1" value="<%= enviosLinha1 %>"></label>
      <label><small>Envios — Linha 2</small><input type="text" name="enviosLinha2" value="<%= enviosLinha2 %>"></label>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" type="submit">Salvar</button>
        <a class="btn secondary" href="/paginas">Voltar</a>
      </div>
    </form>
  </div>
</div>

<script>
(function(){
  const flashBox = document.getElementById('flash-box');
  function show(msg){
    flashBox.style.display = 'flex';
    flashBox.textContent = '✅ ' + (msg || 'Salvo com sucesso!');
  }

  // 1) Se o servidor passou 'flash'
  const hasServerFlash = <%= (typeof flash !== 'undefined' && flash) ? 'true' : 'false' %>;
  if (hasServerFlash) { show(<%- JSON.stringify(flash || '') %>); return; }

  // 2) Se veio com ?saved=1
  const params = new URLSearchParams(location.search);
  if (params.get('saved') === '1') { show(); return; }

  // 3) Fallback: localStorage flag
  const KEY = 'flash_paginas_formas';
  if (localStorage.getItem(KEY) === '1') {
    localStorage.removeItem(KEY);
    show();
  }

  // Marca antes de enviar o form
  window.addEventListener('DOMContentLoaded', function(){
    const form = document.querySelector('form[action="/paginas-formas/save"]');
    if (form) {
      form.addEventListener('submit', function(){
        try { localStorage.setItem(KEY, '1'); } catch(e){}
      });
    }
  });
})();
</script>
