<% layout('layout') -%>
<div class="card">
  <h3>ğŸ  PÃ¡gina Inicial (Visual)</h3>
  <p class="muted mb-2">Edite o conteÃºdo visualmente abaixo ou use o modo cÃ³digo. O botÃ£o "Recarregar" importa o conteÃºdo atual do arquivo HTML.</p>

  <textarea id="editorVisual"><%- content %></textarea>
  <div style="margin-top:10px;display:flex;gap:8px;">
    <button id="saveVisual" class="btn primary">ğŸ’¾ Salvar (Visual)</button>
    <a href="/paginas/edit?file=<%= file %>" class="btn ghost">ğŸ”„ Recarregar do HTML</a>
  </div>

  <hr style="margin:25px 0;">

  <form method="post" action="/paginas/save">
    <input type="hidden" name="file" value="<%= file %>">
    <label>Modo CÃ³digo (HTML)</label>
    <textarea name="content" rows="15" class="w-full border p-2 font-mono"><%- content %></textarea>
    <button class="btn mt-2">Salvar (CÃ³digo)</button>
  </form>
</div>

<script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js"></script>
<script>
let editor;
ClassicEditor.create(document.querySelector('#editorVisual'), {
  toolbar: [
    'heading','|','bold','italic','underline','link','bulletedList','numberedList','blockQuote',
    '|','insertTable','imageUpload','mediaEmbed','undo','redo','sourceEditing'
  ],
  heading: {
    options: [
      { model: 'paragraph', title: 'ParÃ¡grafo', class: 'ck-heading_paragraph' },
      { model: 'heading2', view: 'h2', title: 'TÃ­tulo 2', class: 'ck-heading_heading2' },
      { model: 'heading3', view: 'h3', title: 'TÃ­tulo 3', class: 'ck-heading_heading3' }
    ]
  }
}).then(e => {
  editor = e;
  document.getElementById('saveVisual').addEventListener('click', async () => {
    const conteudo = editor.getData();
    const resp = await fetch('/paginas/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ file: '<%= file %>', content: conteudo })
    });
    alert(resp.ok ? 'âœ… PÃ¡gina salva com sucesso!' : 'âŒ Erro ao salvar.');
    if(resp.ok) location.reload();
  });
}).catch(console.error);
</script>
