<% layout('layout') -%>
<div class="card">
  <h3>üì¶ Produtos</h3>

  <form method="post" action="/produtos/add" class="row">
    <div><label>Nome</label><input type="text" name="name"></div>
    <div><label>Pre√ßo</label><input type="number" name="price" step="0.01" min="0" placeholder="opcional"></div>

    <div>
      <label>Imagem</label>
      <select name="image">
        <option value="">Selecione...</option>
        <% (imagens || []).forEach(img => { %>
          <option value="images/<%= img %>"><%= img %></option>
        <% }) %>
      </select>
    </div>

    <div>
      <label>Categoria</label>
      <select name="category">
        <option value="">In√≠cio (vitrine)</option>
        <% (categorias || []).forEach(c => { %>
          <option value="<%= c.slug %>"><%= c.name %></option>
        <% }) %>
      </select>
    </div>

    <div>
      <label>Mostrar pre√ßo</label>
      <select name="showPrice">
        <option value="true" selected>Sim</option>
        <option value="false">N√£o</option>
      </select>
    </div>

    <div>
      <label>Mostrar na vitrine</label>
      <select name="featured">
        <option value="true">Sim</option>
        <option value="false" selected>N√£o</option>
      </select>
    </div>

    <div>
      <label>Ativo</label>
      <select name="active">
        <option value="true" selected>Sim</option>
        <option value="false">N√£o</option>
      </select>
    </div>

    <div style="align-self:end">
      <button class="btn primary" type="submit">Adicionar</button>
    </div>
  </form>

  <table class="table">
    <thead>
      <tr>
        <th>#</th>
        <th>Nome</th>
        <th>Pre√ßo</th>
        <th>Categoria</th>
        <th>Mostrar Pre√ßo</th>
        <th>Vitrine</th>
        <th>Ativo</th>
        <th>Imagem</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      <% (items || []).forEach((p, idx) => { %>
        <tr>
          <td><span class="badge"><%= idx + 1 %></span></td>

          <td><input form="f<%=p.id%>" type="text" name="name" value="<%= p.name %>"></td>
          <td><input form="f<%=p.id%>" type="number" step="0.01" min="0" name="price" value="<%= p.price || '' %>"></td>

          <td>
            <select form="f<%=p.id%>" name="category">
              <option value="">In√≠cio (vitrine)</option>
              <% (categorias || []).forEach(c => { %>
                <option value="<%= c.slug %>" <%= p.category === c.slug ? 'selected' : '' %>><%= c.name %></option>
              <% }) %>
            </select>
          </td>

          <td>
            <select form="f<%=p.id%>" name="showPrice">
              <option value="true" <%= p.showPrice !== false ? 'selected' : '' %>>Sim</option>
              <option value="false" <%= p.showPrice === false ? 'selected' : '' %>>N√£o</option>
            </select>
          </td>

          <td>
            <select form="f<%=p.id%>" name="featured">
              <option value="true" <%= p.featured ? 'selected' : '' %>>Sim</option>
              <option value="false" <%= !p.featured ? 'selected' : '' %>>N√£o</option>
            </select>
          </td>

          <td>
            <select form="f<%=p.id%>" name="active">
              <option value="true" <%= p.active ? 'selected' : '' %>>Sim</option>
              <option value="false" <%= !p.active ? 'selected' : '' %>>N√£o</option>
            </select>
          </td>

          <td>
            <select form="f<%=p.id%>" name="image">
              <option value="">Selecione...</option>
              <% (imagens || []).forEach(img => { %>
                <option value="images/<%= img %>" <%= p.image === ('images/' + img) ? 'selected' : '' %>><%= img %></option>
              <% }) %>
            </select>
          </td>

          <td>
            <form id="f<%=p.id%>" method="post" action="/produtos/update">
              <input type="hidden" name="id" value="<%= p.id %>">
              <button class="btn primary">Salvar</button>
            </form>
            <form method="post" action="/produtos/del" style="display:inline">
              <input type="hidden" name="id" value="<%= p.id %>">
              <button class="btn">Excluir</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
